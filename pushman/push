#!/bin/bash

# Function to check if a command exists
command_exists() {
    command -v "$1" >/dev/null 2>&1
}

# Check if git is installed
if ! command_exists git; then
    echo "Error: git is not installed. Please install git and try again."
    exit 1
fi

# Change to the specified directory
cd /home/marten/skriptimine/ || { echo "Error: Unable to change to /home/marten/skriptimine/"; exit 1; }

# Use dialog to create a file selection interface
if ! command_exists dialog; then
    echo "Error: dialog is not installed. Please install dialog and try again."
    exit 1
fi

# Create a temporary file to store the selection
temp_file=$(mktemp)

# Use dialog to create a file selection menu
dialog --title "Select a file to upload" --fselect /home/marten/skriptimine/ 14 48 2>"$temp_file"

# Read the selected file
selected_file=$(cat "$temp_file")
rm "$temp_file"

# Check if a file was selected
if [ -z "$selected_file" ]; then
    echo "No file selected. Exiting."
    exit 1
fi

# Get the current repository name
repo=$(git@github.com:Sunzimaa/skriptimine.git | sed 's/.*\/\([^\/]*\)\.git/\1/')

if [ -z "$repo" ]; then
    echo "Error: Unable to determine the repository name. Are you in a git repository?"
    exit 1
fi

# Prompt user for commit message
read -p "Enter a commit message: " commit_message

# Add the file and commit
git add "$selected_file"
git commit -m "$commit_message"

# Push the changes
echo "Pushing changes to GitHub..."
git push origin HEAD

# Check if push was successful
if [ $? -eq 0 ]; then
    echo "File uploaded successfully!"
    echo "The file has been pushed to your GitHub repository."
else
    echo "Error: Failed to push the changes to GitHub."
    echo "Please ensure you have the necessary permissions and your local repository is up to date."
    exit 1
fi











